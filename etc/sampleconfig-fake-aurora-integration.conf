# WARNING: duplicate yaml-nodes are overwritten by latest version
---
steps:
    - upload
    - unpack
    - stop
    - activate
    - start

dns_suffix: aurora.integration.mp.ecg.so
platform: aurora
environment: integration
keepversions: 5
logs: /opt/logs
tarballs: /opt/tarballs
graphite: {carbon_host: mp-graph001, carbon_port: 2003, metric_prefix: mp.events.releases}
history: {archivedir: /opt/tarballs/archive/aurora/, depth: 5}
user: mpdeploy
#deployment_order: [properties, scrubby, cardetails, category, payment, medialibrary,
#    emailcenter, location, datawarehousehub, user, searchintelligence, orderservice,
#    bids, favorites, marketplace, voyagerindexer, voyagersearcher, advertisementhub,
#    customermessaging, authorization, notification, flagservice, guaranteedbidlifecycle,
#    lifecycle, frontend, admin]

# hostgroups need to be prefixed with a datacenter name
# hostnames must have the datacenter name as the last item when split on '.'
datacenters:
    - dro
    - fra

hostgroup:
    dro_fe:
        hosts:
            - fe001.dro
            - fe002.dro
        lb: felb001.dro
    dro_be:
        hosts:
            - be001.dro
            - be002.dro
        lb: belb001.dro
    dro_scrubber:
        hosts:
            - scrubber001.dro
            - scrubber002.dro
    dro_fe_mock:
        hosts:
            - mock001.dro
        lb: felb001.dro
    dro_be_mock:
        hosts:
            - mock001.dro
        lb: belb001.dro
    dro_some_fe_service:
        hosts:
            - fe001.dro
        lb: felb001.dro
    fra_fe:
        hosts:
            - fe001.fra
            - fe002.fra
        lb: felb001.fra
    fra_be:
        hosts:
            - be001.fra
            - be002.fra
        lb: belb001.fra
    fra_scrubber:
        hosts:
            - scrubber001.fra
            - scrubber002.fra
    fra_fe_mock:
        hosts:
            - mock001.fra
        lb: felb001.fra
    fra_be_mock:
        hosts:
            - mock001.fra
        lb: belb001.fra

daemontools_defaults:
    control:
        handler: /usr/bin/svc
        stop: -d
        start: -u
        restart: -t
    location: /etc/service
    startup_try_count: 30

http_defaults:
    check: /usr/lib/nagios/plugins/check_http -I localhost -u http://localhost:{port}/ -p {port} -e "200,301"

thrift_defaults:
    check: /usr/lib/nagios/ecg-plugins/check_service_health.py localhost {port}

service_defaults:
    control_type: daemontools
    destination: /opt/tarballs
    install_location: /opt/webapps

properties_defaults:
    control_type: props
    install_location: /etc/marktplaats
    hostgroups:
        - dro_fe
        - dro_be
        - dro_scrubber
        - dro_fe_mock
        - dro_be_mock
        - fra_fe
        - fra_be
        - fra_scrubber
        - fra_fe_mock
        - fra_be_mock

frontend_defaults:
    protocol: http
    hostgroups:
        - dro_fe
        - fra_fe

backend_defaults:
    protocol: thrift
    hostgroups:
        - dro_be
        - fra_be

scrubber_defaults:
    protocol: thrift
    hostgroups:
        - dro_scrubber
        - fra_scrubber

fe_mock_defaults:
    protocol: http
    hostgroups:
        - dro_fe_mock
        - fra_fe_mock

be_mock_defaults:
    protocol: thrift
    hostgroups:
        - dro_be_mock
        - fra_be_mock

service:
    nl.marktplaats.advertisementhub.advertisementhub-server:
        port: 10530
        jport: 10537
        service_type: backend
        check: /usr/lib/nagios/ecg-plugins/check_service_jolokia.py localhost {jport}
    nl.marktplaats.advertisementlifecycle.advertisementlifecycle-server:
        port: 10550
        jport: 10557
        service_type: backend
    nl.marktplaats.marktplaats-properties:
        service_type: properties
    nl.marktplaats.marktplaats-frontend:
        port: 8080
        protocol: http
        service_type: frontend
    some_fe_mock:
        port: 9001
        service_type: fe_mock
    some_be_mock:
        port: 9002
        service_type: be_mock
    some_fe_service_with_its_own_hostgroups:
        port: 9003
        service_type: frontend
        hostgroups:
        - dro_some_fe_service

lb_defaults:
    api_user: nsroot
    api_password: nsroot

lb:
    felb001.dro:
        ipaddress: felb001.dro
    belb001.dro:
        ipaddress: belb001.dro
    felb001.fra:
        ipaddress: felb001.fra
    belb001.fra:
        ipaddress: belb001.fra
